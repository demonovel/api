{"version":3,"file":"mixinDB.js","sourceRoot":"","sources":["mixinDB.ts"],"names":[],"mappings":";;;;;AACA,8DAAsC;AACtC,sDAA8B;AAE9B,kBAAoB;IAEnB,KAAK,CAAC,KAAK;QAEV,OAAO,OAAO,CAAC,GAAG,CAAC;YAClB,oBAAU,CAAC,KAAK,IAAI,oBAAU,CAAC,KAAK,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;YACxF,gBAAM,CAAC,KAAK,IAAI,gBAAM,CAAC,KAAK,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;SAC5E,CAAC,CAAA;IACH,CAAC;IAED,KAAK,CAAC,IAAI;QAET,OAAO,OAAO,CAAC,GAAG,CAAC;YAClB,oBAAU,CAAC,IAAI,IAAI,oBAAU,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;YACtF,gBAAM,CAAC,IAAI,IAAI,gBAAM,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;SAC1E,CAAC,CAAA;IACH,CAAC;IAED,GAAG,CAAC,MAAc,EAAE,MAAc;QAEjC,OAAO,oBAAU,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC;aACnC,KAAK,CAAC,CAAC,CAAC,EAAE;YACV,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;YAC1C,OAAO,gBAAM,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;QAClC,CAAC,CAAC,CAAA;IACJ,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,MAAc,EAAE,MAAc,EAAE,IAAW;QAEpD,IAAI,KAAK,GAAG,MAAM,oBAAU,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC;aACpD,KAAK,CAAC,CAAC,CAAC,EAAE;YACV,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;QAC3C,CAAC,CAAC,CACF;QAED,IAAI,CAAC,GAAG,gBAAM,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,CAAA;QAExC,IAAI,OAAO,KAAK,KAAK,WAAW,EAChC;YACC,OAAO,CAAC,CAAA;SACR;QAED,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;QAEvB,OAAO,KAAK,CAAA;IACb,CAAC;CACD,CAAA","sourcesContent":["import { IDB, IData } from './types';\nimport firebaseDB from './firebaseDB';\nimport fileDB from './fileDB';\n\nexport default <IDB>{\n\n\tasync start()\n\t{\n\t\treturn Promise.all([\n\t\t\tfirebaseDB.start && firebaseDB.start().catch(e => console.error(`db.start.firebase`, e)),\n\t\t\tfileDB.start && fileDB.start().catch(e => console.error(`db.start.file`, e)),\n\t\t])\n\t},\n\n\tasync stop()\n\t{\n\t\treturn Promise.all([\n\t\t\tfirebaseDB.stop && firebaseDB.stop().catch(e => console.error(`db.start.firebase`, e)),\n\t\t\tfileDB.stop && fileDB.stop().catch(e => console.error(`db.start.file`, e)),\n\t\t])\n\t},\n\n\tget(siteID: string, hashID: string): Promise<IData>\n\t{\n\t\treturn firebaseDB.get(siteID, hashID)\n\t\t\t.catch(e => {\n\t\t\t\tconsole.warn(`db.get`, siteID, hashID, e);\n\t\t\t\treturn fileDB.get(siteID, hashID)\n\t\t\t})\n\t},\n\n\tasync set(siteID: string, hashID: string, data: IData): Promise<IData>\n\t{\n\t\tlet value = await firebaseDB.set(siteID, hashID, data)\n\t\t\t.catch(e => {\n\t\t\t\tconsole.warn(`db.set`, siteID, hashID, e);\n\t\t\t})\n\t\t;\n\n\t\tlet p = fileDB.set(siteID, hashID, data)\n\n\t\tif (typeof value === 'undefined')\n\t\t{\n\t\t\treturn p\n\t\t}\n\n\t\tp = p.catch(e => null);\n\n\t\treturn value\n\t},\n}\n"]}