{"version":3,"file":"firebaseDB.js","sourceRoot":"","sources":["firebaseDB.ts"],"names":[],"mappings":";AAAA;;GAEG;;;;;AAEH,wDAAgC;AAChC,6DAA6E;AAC7E,iCAAiD;AAGjD,IAAI,GAAqB,CAAC;AAC1B,IAAI,QAAoC,CAAC;AACzC,IAAI,EAA6B,CAAC;AAElC,MAAM,GAAG,GAAQ;IAEhB,KAAK,CAAC,KAAK;QAEV,IAAI,CAAC,QAAQ,EACb;YACC,GAAG,GAAG,MAAM,kBAAQ,CAAC,aAAa,CAAC;gBAClC,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,eAAe;gBACxC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU;aAC9B,CAAC,CAAC;YAEH,QAAQ,GAAG,MAAM,GAAG,CAAC,QAAQ,EAAE,CAAC;YAChC,EAAE,GAAG,MAAM,IAAA,0CAAoB,EAAU,QAAQ,CAAC,CAAC;YAEnD;;;;;;;;;eASG;SACH;QACD,MAAM,QAAQ,CAAC,QAAQ,EAAE,CAAC;IAC3B,CAAC;IAED,KAAK,CAAC,IAAI;QAET,IAAI,QAAQ,EACZ;YACC,MAAM,QAAQ,CAAC,SAAS,EAAE,CAAC;SAC3B;IACF,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,MAAc,EAAE,MAAc;QAEvC,IAAA,kBAAW,EAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAE5B,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC;QAElB,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;aAC7B,IAAI,CAAC,IAAI,CAAC,EAAE;YACZ,IAAI,CAAC,IAAI,EACT;gBACC,OAAO,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,MAAM,MAAM,sBAAsB,CAAC,CAAA;aACnE;YAED,OAAO,IAAI,CAAA;QACZ,CAAC,CAAC,CAAA;IACJ,CAAC;IACD,KAAK,CAAC,GAAG,CAAC,MAAc,EAAE,MAAc,EAAE,IAAW,EAAE,IAAiB;QAEvE,IAAA,kBAAW,EAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAC5B,IAAA,iBAAU,EAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAEvB,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC;QAElB,aAAa;QACb,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,IAAI,CAAC;aACnC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAA;IAClB,CAAC;CAED,CAAC;AAEF,kBAAe,GAAG,CAAA","sourcesContent":["/**\n * Created by user on 2020/3/1.\n */\n\nimport firebase from \"firebase\";\nimport { wrapFirebaseDatabase, RealtimeDatabase } from \"realtime-db-adaptor\";\nimport { assertData, assertDBKey } from './util';\nimport { ISchema, IData, IDB, EnumApiType } from './types';\n\nlet app: firebase.app.App;\nlet database: firebase.database.Database;\nlet db: RealtimeDatabase<ISchema>;\n\nconst api = <IDB>{\n\n\tasync start()\n\t{\n\t\tif (!database)\n\t\t{\n\t\t\tapp = await firebase.initializeApp({\n\t\t\t\tdatabaseURL: process.env.MY_DATABASE_URL,\n\t\t\t\tapiKey: process.env.MY_API_KEY,\n\t\t\t});\n\n\t\t\tdatabase = await app.database();\n\t\t\tdb = await wrapFirebaseDatabase<ISchema>(database);\n\n\t\t\t/*\n\t\t\tconsole.log({\n\t\t\t\tdatabaseURL: process.env.MY_DATABASE_URL,\n\t\t\t\tapiKey: process.env.MY_API_KEY,\n\n\t\t\t\tapp,\n\t\t\t\tdatabase,\n\t\t\t\tdb,\n\t\t\t})\n\t\t\t */\n\t\t}\n\t\tawait database.goOnline();\n\t},\n\n\tasync stop()\n\t{\n\t\tif (database)\n\t\t{\n\t\t\tawait database.goOffline();\n\t\t}\n\t},\n\n\tasync get(siteID: string, hashID: string): Promise<IData>\n\t{\n\t\tassertDBKey(siteID, hashID);\n\n\t\tawait api.start();\n\n\t\treturn db.get([siteID, hashID])\n\t\t\t.then(data => {\n\t\t\t\tif (!data)\n\t\t\t\t{\n\t\t\t\t\treturn Promise.reject(`'${siteID}' '${hashID}' data is not exists`)\n\t\t\t\t}\n\n\t\t\t\treturn data\n\t\t\t})\n\t},\n\tasync set(siteID: string, hashID: string, data: IData, type: EnumApiType): Promise<IData>\n\t{\n\t\tassertDBKey(siteID, hashID);\n\t\tassertData(data, type);\n\n\t\tawait api.start();\n\n\t\t// @ts-ignore\n\t\treturn db.set([siteID, hashID], data)\n\t\t\t.then(e => data)\n\t},\n\n};\n\nexport default api\n"]}