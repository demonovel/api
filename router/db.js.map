{"version":3,"file":"db.js","sourceRoot":"","sources":["db.ts"],"names":[],"mappings":";;;;;AAAA,qCAA0C;AAG1C,mDAA+B;AAE/B,kBAAe,GAAG,EAAE;IAEnB,MAAM,MAAM,GAAG,gBAAM,EAAE,CAAC;IAExB,MAAM,CAAC,GAAG,CAAC,uBAAuB,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;QAE5D,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;QAEpC,IAAI,CAAe,CAAC;QAEpB,mBAAmB;QACnB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;QAE9C,IAAI,GAAG,CAAC,MAAM,KAAK,MAAM,IAAI,GAAG,CAAC,MAAM,KAAK,KAAK,EACjD;YACC,CAAC,GAAG,YAAM,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,CAAA;SACxC;aAED;YACC,CAAC,GAAG,YAAM,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;SAC9B;QAED,OAAO,CAAC;aACN,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC;YACtB,KAAK,EAAE,KAAK;YACZ,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;YACrB,IAAI;SACJ,CAAC,CAAC;aACF,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;YAChC,KAAK,EAAE,IAAI;YACX,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;YACrB,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;SAClB,CAAC,CAAC;aACF,OAAO,CAAC,GAAG,EAAE,CAAC,YAAM,CAAC,IAAI,EAAE,CAAC,CAC7B;IACF,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM,CAAA;AACd,CAAC,CAAA","sourcesContent":["import express, { Router } from 'express';\nimport { readJSON } from 'fs-extra';\nimport { resolve } from 'path';\nimport siteDB from '../lib/db';\n\nexport default () =>\n{\n\tconst router = Router();\n\n\trouter.all('/file/:siteID/:hashID', async (req, res, next) =>\n\t{\n\t\tlet { siteID, hashID } = req.params;\n\n\t\tlet p: Promise<any>;\n\n\t\t//console.log(req);\n\t\tconsole.log(req.method, req.params, req.body);\n\n\t\tif (req.method === 'POST' || req.method === 'PUT')\n\t\t{\n\t\t\tp = siteDB.set(siteID, hashID, req.body)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tp = siteDB.get(siteID, hashID)\n\t\t}\n\n\t\treturn p\n\t\t\t.then(data => res.json({\n\t\t\t\terror: false,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t\tdata,\n\t\t\t}))\n\t\t\t.catch(e => res.status(400).json({\n\t\t\t\terror: true,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t\tmessage: String(e),\n\t\t\t}))\n\t\t\t.finally(() => siteDB.stop())\n\t\t;\n\t});\n\n\treturn router\n}\n"]}