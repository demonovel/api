{"version":3,"file":"file.js","sourceRoot":"","sources":["file.ts"],"names":[],"mappings":";;;;;AAAA,qCAA0C;AAG1C,mDAA+B;AAE/B,kBAAe,GAAG,EAAE;IAEnB,MAAM,MAAM,GAAG,gBAAM,EAAE,CAAC;IAExB,MAAM,CAAC,GAAG,CAAC,kBAAkB,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;QAEvD,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;QAEpC,IAAI,EAAE,GAAG,MAAM,YAAM,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC;aACvC,IAAI,CAAC,IAAI,CAAC,EAAE;YAEZ,IAAI,IAAI,CAAC,IAAI,EACb;gBACC,IAAI,GAAG,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAE7B,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,EACrC;oBACC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;oBACvB,OAAO,IAAI,CAAC;iBACZ;aACD;QACF,CAAC,CAAC;aACD,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC;aAChB,OAAO,CAAC,GAAG,EAAE,CAAC,YAAM,CAAC,IAAI,EAAE,CAAC,CAC7B;QAED,IAAI,EAAE,EACN;YACC,OAAO;SACP;QAED,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAChB,IAAI,EAAE,CAAC;IACR,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM,CAAA;AACd,CAAC,CAAA","sourcesContent":["import express, { Router } from 'express';\nimport { readJSON } from 'fs-extra';\nimport { resolve } from 'path';\nimport siteDB from '../lib/db';\n\nexport default () =>\n{\n\tconst router = Router();\n\n\trouter.use('/:siteID/:hashID', async (req, res, next) =>\n\t{\n\t\tlet { siteID, hashID } = req.params;\n\n\t\tlet ok = await siteDB.get(siteID, hashID)\n\t\t\t.then(data =>\n\t\t\t{\n\t\t\t\tif (data.href)\n\t\t\t\t{\n\t\t\t\t\tlet url = new URL(data.href);\n\n\t\t\t\t\tif (!url.hostname.includes('.now.sh'))\n\t\t\t\t\t{\n\t\t\t\t\t\tres.redirect(url.href);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(e => null)\n\t\t\t.finally(() => siteDB.stop())\n\t\t;\n\n\t\tif (ok)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tres.status(404);\n\t\tnext();\n\t});\n\n\treturn router\n}\n"]}